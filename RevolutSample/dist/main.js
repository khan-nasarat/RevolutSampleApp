(()=>{"use strict";var e,t="prod",o=((e={}).sandbox="https://sandbox-merchant.revolut.com/embed.js",e.prod="https://merchant.revolut.com/embed.js",e.dev="https://merchant.revolut.codes/embed.js",e),n=null;function a(e,t,c){if(void 0===t&&(t=a.mode),n){var r=n({publicToken:e,locale:c});return Promise.resolve(r)}var u=document.createElement("script");return u.id="revolut-payments",u.src=o[t],u.async=!0,document.head.appendChild(u),new Promise((function(t,o){function a(){document.head.removeChild(u),o(new Error("'RevolutPayments' failed to load"))}u.onload=function(){"function"==typeof RevolutCheckout?(t(RevolutCheckout.payments({publicToken:e,locale:c})),n=RevolutCheckout.payments,delete window.RevolutCheckout):a()},u.onerror=a}))}a.mode=t;var c,r,u=null;function l(e,t){if(void 0===t&&(t=l.mode),u)return u(e);var n=document.createElement("script");return n.id="revolut-checkout",n.src=o[t],n.async=!0,document.head.appendChild(n),new Promise((function(t,o){function a(){document.head.removeChild(n),o(new Error("'RevolutCheckout' is failed to load"))}n.onload=function(){"function"==typeof RevolutCheckout?(t(RevolutCheckout(e)),u=RevolutCheckout,delete window.RevolutCheckout):a()},n.onerror=a}))}l.mode=t,l.payments=function(e){var t=e.locale,o=e.publicToken,n=e.mode;return a(o,void 0===n?l.mode:n,t)};const s=(async()=>{var e=await d();return await l.payments({local:"en",mode:e.Mode,publicToken:e.PublicToken})})();async function d(){var e;return $.ajax({url:"/Pages/Basket.aspx/GetBasketTotal",contentType:"application/json",type:"POST",async:!1,success:function(t){e=t.d},error:function(e){}}),e}function i(){console.log("reloadBasket call.."),m(!0)}async function m(e){console.log("createRevolutPayment 1");var t=await d();const o={buttonStyle:{cashback:!1},currency:t.CurrencyCode,totalAmount:t.BasketTotal,createOrder:async()=>(await async function(){$.ajax({url:"/Pages/Payment/Revolut/RevolutWebMethods.aspx/CreateOrder",contentType:"application/json",type:"POST",async:!1,success:function(e){!0===e.d.isAuthorized?location.href=e.d.returnURL:(c=e.d.Public_Id,r=e.d.Id)},error:function(e){}})}(),{publicId:c})};e?(console.log("recreateBasket 1"),await s.then((e=>{console.log("recreateBasket 2",e),e.revolutPay.destroy(),p(e.revolutPay,o),e.revolutPay}))):await s.then((e=>{p(e.revolutPay,o),e.revolutPay}))}function p(e,t){let o=document.getElementById("revolut-pay2.0");e.mount(o,t),e.on("payment",(e=>{switch(console.log(e),e.type){case"cancel":default:break;case"success":$.ajax({url:"/Pages/Payment/Revolut/RevolutWebMethods.aspx/RetriveOrder",data:'{"orderId": "'+r+'"}',contentType:"application/json",type:"POST",async:!1,success:function(e){location.href=e.d.returnURL}});break;case"error":location.href="/"+__countryCode+"pages/payment/PaymentError.aspx?IssueDetails=&ErrorDetails="+e.error.message}})),document.getElementById("reloadBasket").addEventListener("click",i)}document.body.appendChild(async function(){m(!1)}())})();